From 38d0d9243740ae0aee553be74d68bc9b7fdeb84a Mon Sep 17 00:00:00 2001
From: Kristiaan Van den Eynde <magentix@gmail.com>
Date: Mon, 25 Aug 2014 09:27:35 +0200
Subject: [PATCH] Issue #2112755 by kristiaanvandeneynde, ruscoe: Fixed Call
 to a member function label() on a non-object.

---
 entity.module |   42 ++++++++++++++++++++++--------------------
 1 file changed, 22 insertions(+), 20 deletions(-)

diff --git a/entity.module b/entity.module
index d4a882c..49eac8f 100644
--- a/entity.module
+++ b/entity.module
@@ -184,28 +184,30 @@ function entity_ui_entity_page_view($entity) {
  * Gets the page title for the passed operation.
  */
 function entity_ui_get_page_title($op, $entity_type, $entity = NULL) {
-  module_load_include('inc', 'entity', 'includes/entity.ui');
-  $label = entity_label($entity_type, $entity);
-  switch ($op) {
-    case 'view':
-      return $label;
-    case 'edit':
-      return t('Edit @label', array('@label' => $label));
-    case 'clone':
-      return t('Clone @label', array('@label' => $label));
-    case 'revert':
-      return t('Revert @label', array('@label' => $label));
-    case 'delete':
-      return t('Delete @label', array('@label' => $label));
-    case 'export':
-      return t('Export @label', array('@label' => $label));
-  }
+  $bundle = NULL;
+
   if (isset($entity)) {
-    list(, , $bundle) = entity_extract_ids($entity_type, $entity);
-  }
-  else {
-    $bundle = NULL;
+    module_load_include('inc', 'entity', 'includes/entity.ui');
+    $label = entity_label($entity_type, $entity);
+
+    switch ($op) {
+      case 'view':
+        return $label;
+      case 'edit':
+        return t('Edit @label', array('@label' => $label));
+      case 'clone':
+        return t('Clone @label', array('@label' => $label));
+      case 'revert':
+        return t('Revert @label', array('@label' => $label));
+      case 'delete':
+        return t('Delete @label', array('@label' => $label));
+      case 'export':
+        return t('Export @label', array('@label' => $label));
+      default:
+        list(, , $bundle) = entity_extract_ids($entity_type, $entity);
+    }
   }
+
   return entity_ui_get_action_title($op, $entity_type, $bundle);
 }
 
-- 
1.7.9.4

